{% extends 'base.html' %}
{% block title %}Transactions — Dex Inv{% endblock %}
{% block pagetitle %}Transaction Log{% endblock %}
{% block breadcrumb %}dex-inv / transactions{% endblock %}

{% block content %}
<div class="card" style="animation:pageIn .35s ease both">
  <div class="card-hd">
    <span>Stock Activity</span>
    <span style="color:var(--muted2);font-family:var(--font-mono);font-size:10px">{{ transactions|length }} records</span>
  </div>
  <div style="overflow-x:auto">
    <table class="dtable">
      <thead><tr>
        <th>#</th><th>Timestamp</th><th>Product</th><th>Type</th><th>Qty Δ</th><th>Note</th>
        {% if session.role=='admin' %}<th>User</th>{% endif %}
      </tr></thead>
      <tbody>
        {% for tx in transactions %}
        <tr>
          <td style="font-family:var(--font-mono);font-size:11px;color:var(--muted2)">{{ tx.id }}</td>
          <td style="font-family:var(--font-mono);font-size:11px;color:var(--muted2);white-space:nowrap">{{ tx.timestamp }}</td>
          <td style="font-weight:500;font-size:13px">{{ tx.product_name }}</td>
          <td>
            {% set tc = tx.type.lower() %}
            <span class="chip {% if tc in ('restock','added') %}chip-green{% elif tc=='dispatch' %}chip-yellow{% elif tc=='deleted' %}chip-red{% else %}chip-blue{% endif %}">
              {{ tx.type }}
            </span>
          </td>
          <td style="font-family:var(--font-mono);font-weight:700;color:{% if tx.quantity_change>0 %}#06d6a0{% elif tx.quantity_change<0 %}#ff4d6d{% else %}var(--muted2){% endif %}">
            {{ '+' if tx.quantity_change > 0 else '' }}{{ tx.quantity_change }}
          </td>
          <td style="color:var(--muted2);font-size:12px">{{ tx.note or '—' }}</td>
          {% if session.role=='admin' %}<td style="font-family:var(--font-mono);font-size:11px;color:var(--muted2)">{{ tx.username or '—' }}</td>{% endif %}
        </tr>
        {% else %}
        <tr><td colspan="7" style="text-align:center;padding:40px;color:var(--muted2)">No transactions yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
